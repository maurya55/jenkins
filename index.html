<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <title>Document</title>
</head>

<body>

    <h1>Generate Project</h1>

    <p>
        <lable>project Name: </lable>
        <input type="text" id="project_name" class="project_name" />
    </p>

    <p>
        <lable>db type: </lable>
        <select id="db_type" class="db_type">
            <option value="mysql" selected>mysql</option>
        </select>
    </p>

    <p>
        db config:
    </p>
    <p>
        <label>host :</label>
        <input type="text" id="host" class="host" />
    </p>

    <p>
        <label>username :</label>
        <input type="text" id="username" class="username" />
    </p>


    <p>
        <label>password :</label>
        <input type="text" id="password" class="password" />
    </p>

    <p>
        <label>dbName :</label>
        <input type="text" id="db_name" class="db_name" />
    </p>

    <button id="generate_btn">Generate Porject</button>

    <hr />

    <h2>Insert Database</h2>

    <p>
        <label>project Name :</label>
        <input type="text" id="database_project_name" class="database_project_name" />
    </p>

    <p>
        crud for :
        <label for="create">create</label>
        <input type="checkbox" class="crud" value="create" name="crud">
        <label for="read">read</label>
        <input type="checkbox" class="crud" value="read" name="crud">
        <label for="update">update</label>
        <input type="checkbox" class="crud" value="update" name="crud">
        <label for="delete">delete</label>
        <input type="checkbox" class="crud" value="delete" name="crud">

    </p>

    <p>
        <label>Table Name :</label>
        <input type="text" id="table_name" class="table_name" />
    </p>

    <div id="div_table_field">

        <p>
            <label>field_name :</label>
            <input type="text" id="primary_field_name" />

            <label>type :</label>
            <select id="primary_type_name">
                <option value="int">int</option>
                <option value="string">string</option>
            </select>

            <label>primary_key :</label>
            <select id="primary_key">
                <option value=true>true</option>
                <option value=false>false</option>
            </select>

        </p>


    </div>
    <button id="add_field_btn">Add field</button>

    <br />
    <button id="create_database">create database</button>

    <hr />
    <hr />


    <h4>
        Add curd
    </h4>

    <div>
        <p>
            <lable>project Name: </lable>
            <input type="text" id="project_name_crud_for" class="project_name_crud_for" />
        </p>

        <p>
            <lable>db Name: </lable>
            <input type="text" id="database_name_crud_for" class="database_name_crud_for" />
        </p>
        <p>
            crud for :
            <label for="create">create</label>
            <input type="checkbox" class="crud_for" value="create" name="crud_for">
            <label for="read">read</label>
            <input type="checkbox" class="crud_for" value="read" name="crud_for">
            <label for="update">update</label>
            <input type="checkbox" class="crud_for" value="update" name="crud_for">
            <label for="delete">delete</label>
            <input type="checkbox" class="crud_for" value="delete" name="crud_for">
        </p>

        <button id="add_crud_btn">Add crud</button>
    </div>


    <hr />
    <hr />

    <h4>
        delete curd
    </h4>

    <div>
        <p>
            <lable>project Name: </lable>
            <input type="text" id="project_name_crud_for_delete" class="project_name_crud_for_delete" />
        </p>

        <p>
            <lable>db Name: </lable>
            <input type="text" id="database_name_crud_for_delete" class="database_name_crud_for_delete" />
        </p>
        <p>
            crud for :
            <label for="create">create</label>
            <input type="radio" class="crud_for_delete" value="create" name="crud_for_delete">
            <label for="read">read</label>
            <input type="radio" class="crud_for_delete" value="read" name="crud_for_delete">
            <label for="update">update</label>
            <input type="radio" class="crud_for_delete" value="update" name="crud_for_delete">
            <label for="delete">delete</label>
            <input type="radio" class="crud_for_delete" value="delete" name="crud_for_delete">
        </p>

        <button id="delete_crud_btn">delete crud</button>
    </div>


</body>

<script>


    console.log("Testing");

    console.log("ok");

    $(document).ready(function () {
        $("#generate_btn").click(function () {
            var generateData = {
                "project_name": $("#project_name").val().trim(),
                "db_type": $("#db_type").val(),
                "language": {
                    "type": "javascript",
                    "framework": "express",
                    "version": 12.3,
                    "buildtool": "maven"
                },
                "repo_details": {
                    "type": "Bitbucket",
                    "username": "xyz",
                    "password": "abc"
                },
                "build_pipeline": "aws",
                "db_config": {
                    "host": $("#host").val().trim(),
                    "user": $("#username").val().trim(),
                    "password": $("#password").val().trim(),
                    "db": $("#db_name").val().trim(),
                },

                "db_details": []
            }




            // var generateData = {
            //     "project_name": "project",
            //     "db_type": "mysql",
            //     "language": {
            //         "type": "javascript",
            //         "framework": "express",
            //         "version": 12.3,
            //         "buildtool": "maven"
            //     },
            //     "repo_details": {
            //         "type": "Bitbucket",
            //         "username": "xyz",
            //         "password": "abc"
            //     },
            //     "build_pipeline": "aws",
            //     "db_config": {
            //         "host": "localhost",
            //         "user": "root",
            //         "password": "",
            //         "db": "test"
            //     },
            //     "db_details": [{
            //         "table_name": "user",
            //         "crud_for": [
            //             "create",
            //             "update"
            //         ],
            //         "table_fields": [
            //             { "field_name": "id", "type": "int", "primary_key": true, "is_unique": true },
            //             { "field_name": "name", "type": "string", "is_unique": true, "max_length": 20, "min_length": 5 },
            //             { "field_name": "email", "type": "string", "is_unique": true, "max_length": 100 }
            //         ]
            //     },
            //     {
            //         "table_name": "userAddress",
            //         "crud_for": [
            //             "create"
            //         ],
            //         "table_fields": [
            //             { "field_name": "id", "type": "int", "primary_key": true, "is_unique": true },
            //             { "field_name": "address", "type": "string", "is_unique": true, "max_length": 20, "min_length": 5 },
            //             { "field_name": "pincode", "type": "string", "is_unique": true, "max_length": 100 }
            //         ]
            //     }

            //     ]
            // }

            console.log(generateData);

            $.ajax({
                url: "http://localhost:3000/generator",
                type: "POST",
                // dataType: 'json',
                // cache: false,
                // headers: {
                //     'Content-Type': 'application/json',
                //     Accept: 'application/json'
                // },
                data: {
                    allData: JSON.stringify(generateData)
                },
                success: function (response) {
                    console.log(response);
                }
            })

        })


        $("#add_field_btn").click(function () {

            let fieldData = `
            <p>
            <label>field_name :</label>
            <input type="text"  class="field_name" />

            <label>type :</label>
            <select class="field_type" >
                <option value="int" >int</option>
                <option value="string" >string</option>
            </select>

            <label>is_unique :</label>
            <select class="is_unique" >
                <option value=false >false</option>
                <option value=true >true</option>
            </select>


            <label>max_length :</label>
            <input type="text"  class="max_length" />


            <label>min_length :</label>
            <input type="text"  class="min_length" />

            <button>remove</button>

        </p>
            `;

            $("#div_table_field").append(fieldData);

        })


        $("#create_database").click(function () {

            // console.log();

            var fieldInput = $(".field_name");

            var allData = [{
                field_name: $("#primary_field_name").val(),
                type: $("#primary_type_name").val(),
                primary_key: $("#primary_key").val(),
                is_unique: true,

            }];

            for (var i = 0; i < fieldInput.length; i++) {

                let filedName1 = $(".field_name").eq(i).val();
                let field_type1 = $(".field_type").eq(i).val();
                let is_unique1 = $(".is_unique").eq(i).val();
                let max_length1 = $(".max_length").eq(i).val();
                let min_length1 = $(".min_length").eq(i).val();
                let obj = {};
                obj['field_name'] = filedName1;
                obj['type'] = field_type1;
                obj['is_unique'] = is_unique1;
                obj['max_length'] = max_length1;
                obj['min_length'] = min_length1;
                allData.push(obj);
            }

            console.log(allData);

            var checkboxes = document.getElementsByName("crud");
            var checkboxesChecked = [];
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked) {
                    checkboxesChecked.push(checkboxes[i].value);
                }
            }


            var arrayData = {
                project_name: document.getElementById("database_project_name").value,
                db_details: [{
                    table_name: document.getElementById("table_name").value,
                    crud_for: checkboxesChecked,
                    table_fields: allData
                }]
            }

            $.ajax({
                url: "http://localhost:3000/generator/database",
                type: "POST",
                data: {
                    allData: JSON.stringify(arrayData)
                },
                success: function (response) {
                    console.log(response);
                }
            })

        })


        $("#add_crud_btn").click(function () {

            var checkboxes = document.getElementsByName("crud_for");
            var checkboxesChecked = [];
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked) {
                    checkboxesChecked.push(checkboxes[i].value);
                }
            }

            var crudData = {
                project_name: $("#project_name_crud_for").val(),
                crud_for: checkboxesChecked,
                dbname: $("#database_name_crud_for").val(),
            }


            $.ajax({
                url: "http://localhost:3000/crud",
                type: "POST",
                data: {
                    allData: JSON.stringify(crudData)
                },
                success: function (response) {
                    console.log(response);
                }
            })

        })






        $("#delete_crud_btn").click(function () {

            var crudData = {
                project_name: $("#project_name_crud_for_delete").val(),
                crud: $('input[name="crud_for_delete"]:checked').val(),
                dbname: $("#database_name_crud_for_delete").val(),
            }

            
            $.ajax({
                url: "http://localhost:3000/crud/delete",
                type: "POST",
                data: crudData,
                success: function (response) {
                    console.log(response);
                }
            })

        })


    })




</script>



</html>